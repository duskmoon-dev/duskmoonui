# Implementation Plan: OKLCH Color System Migration

**Branch**: `004-oklch-color-system` | **Date**: 2025-12-23 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/004-oklch-color-system/spec.md`

## Summary

Migrate all CSS color variables from HSL space-separated format to OKLCH format, following the DaisyUI 5 pattern. Replace static `-focus` color tokens with dynamic `color-mix()` manipulation for hover/focus states. This enables perceptually uniform color operations and better wide-gamut display support.

**Key Changes**:
1. Convert 65+ color tokens from `H S% L%` (HSL) to `oklch(L% C H)` format
2. Replace `hsl(var(--color-*))` with direct `var(--color-*)` usage (OKLCH values stored with wrapper)
3. Replace `-focus` tokens with `color-mix(in oklch, [color], black 10%)` for hover states
4. Update all 28 component CSS files to use new color syntax

## Technical Context

**Language/Version**: CSS3 with modern color functions (OKLCH, color-mix)
**Primary Dependencies**: Tailwind CSS v4.0.0+, LightningCSS for processing
**Storage**: N/A (CSS-only, no data persistence)
**Testing**: Playwright visual regression tests, contrast ratio validation
**Target Platform**: Modern browsers (Chrome 111+, Safari 15.4+, Firefox 113+) - 92%+ global support
**Project Type**: Monorepo with packages/core (plugin) and packages/docs (documentation)
**Performance Goals**: Build output size within 10% of current, no runtime JS for colors
**Constraints**: WCAG AA contrast (4.5:1), no breaking changes to class names
**Scale/Scope**: 65+ color tokens, 28 component files, 2 theme files

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Design System First | ✅ PASS | Maintains 65+ token system, uses OKLCH per constitution v1.3.0 |
| I. Color Format (OKLCH) | ✅ PASS | This feature implements the OKLCH requirement |
| II. Tailwind-Native | ✅ PASS | CSS-only implementation using @layer components |
| III. Component Independence | ✅ PASS | Each component updated independently |
| IV. Type Safety | ✅ PASS | No TypeScript changes required (CSS-only) |
| V. Zero Runtime Dependencies | ✅ PASS | Pure CSS, no JS color manipulation |
| VI. Documentation as Code | ✅ PASS | Will update docs with OKLCH examples |
| VII. Accessibility | ✅ PASS | Will validate contrast ratios during migration |

## Project Structure

### Documentation (this feature)

```text
specs/004-oklch-color-system/
├── plan.md              # This file
├── research.md          # HSL→OKLCH conversion research
├── quickstart.md        # Migration guide for users
├── checklists/
│   └── requirements.md  # Specification checklist
└── tasks.md             # Generated by /speckit.tasks
```

### Source Code (repository root)

```text
packages/core/
├── src/
│   ├── themes/
│   │   ├── sunshine.css     # Light theme - OKLCH migration
│   │   └── moonlight.css    # Dark theme - OKLCH migration
│   ├── components/
│   │   ├── button.css       # Update hsl() → oklch(), add color-mix()
│   │   ├── card.css         # Update color syntax
│   │   ├── input.css        # Update color syntax
│   │   └── [26 more files]  # All 28 components
│   └── index.css            # Main entry point
└── tests/
    └── visual/
        └── *.spec.ts        # Visual regression tests

packages/docs/
├── src/
│   └── content/
│       └── docs/
│           └── colors.mdx   # Update with OKLCH examples
└── astro.config.mjs
```

**Structure Decision**: Existing monorepo structure. Changes are CSS-only within packages/core/src/themes/ and packages/core/src/components/.

## Complexity Tracking

> No constitution violations - all principles satisfied.

N/A - This feature aligns with all constitution principles. The OKLCH migration is explicitly required by Constitution v1.3.0.
